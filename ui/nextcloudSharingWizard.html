<!--
Copyright (c) 2025 Bastian Kleinschmidt
Licensed under the GNU Affero General Public License v3.0.
See LICENSE.txt for details.
-->
<!doctype html>
<meta charset="utf-8">
<title data-i18n="sharing_dialog_title">Nextcloud Freigabe</title>
<link rel="stylesheet" href="tbTheme.css">
<style>
:root{
  --brand-blue:var(--tb-accent);
  --header-height:48px;
  --dialog-accent:var(--tb-accent);
  --dialog-surface:var(--tb-bg);
  --dialog-outline:var(--tb-border);
  --dialog-outline-strong:var(--tb-border-strong);
  --dialog-text:var(--tb-text);
  --dialog-gap:10px;
  --dialog-pad-left:22px;
  --dialog-pad-right:22px;
  --control-height:32px;
  --control-radius:var(--tb-control-radius);
  --control-padding-x:12px;
  --content-max:560px;
  --dialog-shadow:var(--tb-shadow);
}
html,
body{
  height:100%;
}
body{
  margin:0;
  padding:0;
  background:var(--tb-bg);
  font:message-box;
  color:var(--tb-text);
  min-height:0;
  box-sizing:border-box;
  display:flex;
  justify-content:center;
  align-items:flex-start;
}
input,
button,
select,
textarea{
  font:inherit;
}
@keyframes dialogEnter{
  from{opacity:0; transform:translateY(12px);}
  to{opacity:1; transform:translateY(0);}
}
@keyframes stepEnterForward{
  from{opacity:0; transform:translateX(14px);}
  to{opacity:1; transform:translateX(0);}
}
@keyframes stepEnterBack{
  from{opacity:0; transform:translateX(-14px);}
  to{opacity:1; transform:translateX(0);}
}
.nc-dialog{
  width:100%;
  max-width:640px;
  height:100%;
  max-height:640px;
  margin:0 auto;
  background:var(--tb-bg);
  border-radius:var(--tb-radius);
  border:1px solid var(--tb-border);
  box-shadow:none;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  min-height:0;
  box-sizing:border-box;
  animation:dialogEnter .35s ease-out;
}
.nc-dialog-hero{
  background:var(--brand-blue);
  padding:0;
  text-align:center;
  height:var(--header-height);
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  align-items:flex-start;
}
.nc-dialog-hero img{
  width:auto; height:100%; max-width:328px; display:block; object-fit:contain;
  margin:0 auto;
}

.dialog-message{
  min-height:0;
  padding:0 var(--dialog-pad-right) 0 var(--dialog-pad-left);
  font-size:13px;
  display:flex;
  align-items:center;
  box-sizing:border-box;
}
.dialog-message.error{color:#b00020;}
.dialog-message.success{color:#11883a;}
.nc-dialog-content{
  padding:var(--dialog-gap) var(--dialog-pad-right) var(--dialog-gap) var(--dialog-pad-left);
  flex:1;
  display:flex;
  flex-direction:column;
  gap:var(--dialog-gap);
  background:var(--dialog-surface);
  overflow:hidden;
  max-width:var(--content-max);
  width:100%;
  margin:0 auto;
  box-sizing:border-box;
}
.wizard-step{
  display:none;
  will-change:transform,opacity;
}
.wizard-step.active{
  display:block;
  animation:stepEnterForward .22s ease-out;
}
.nc-dialog-content[data-nav="back"] .wizard-step.active{
  animation-name:stepEnterBack;
}
.wizard-step.active[data-step="3"]{
  display:flex;
  flex-direction:column;
  flex:1;
  min-height:0;
}
.wizard-step h2{
  margin:0 0 var(--dialog-gap) 0;
  font-size:14px;
  font-weight:600;
}
.form-row{
  margin-bottom:18px;
  display:flex;
  flex-direction:column;
}
.form-row label{
  font-weight:600;
  margin-bottom:6px;
}
input[type="text"],
input[type="date"],
input[type="password"],
textarea{
  border:1px solid var(--dialog-outline-strong);
  border-radius:var(--control-radius);
  padding:0 var(--control-padding-x);
  width:100%;
  box-sizing:border-box;
  transition:border-color .15s ease, box-shadow .15s ease, background .15s ease;
}
input[type="text"],
input[type="date"],
input[type="password"]{
  height:var(--control-height);
  background:var(--tb-surface);
}
textarea{
  min-height:140px;
  padding:10px 12px;
  background:var(--tb-surface);
}
input[type="text"]:focus,
input[type="date"]:focus,
input[type="password"]:focus,
textarea:focus{
  border-color:var(--dialog-accent);
  background:var(--tb-surface);
  outline:none;
  box-shadow:0 0 0 3px rgba(0,130,201,0.15);
}
.checkbox-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin:10px 0;
}
.checkbox-row input[type="checkbox"]{
  accent-color:var(--dialog-accent);
}
.inline-field{
  display:flex;
  gap:10px;
  align-items:stretch;
  margin-bottom:10px;
}
.inline-field.hidden,
#expireFields.hidden,
#noteFields.hidden,
#passwordFields.hidden{
  display:none;
}
.inline-field button{
  height:var(--control-height);
  padding:0 14px;
  border:1px solid var(--dialog-outline-strong);
  border-radius:var(--control-radius);
  background:var(--tb-surface);
  color:var(--dialog-text);
  cursor:pointer;
  transition:border-color .15s ease,color .15s ease,background .15s ease;
}
.inline-field button:hover{
  border-color:var(--dialog-accent);
  color:var(--dialog-accent);
  background:var(--tb-surface-2);
}
.base-path{
  font-size:13px;
  color:var(--tb-muted);
  margin-bottom:12px;
}
.file-actions{
  display:flex;
  gap:10px;
  margin-bottom:10px;
}
.file-actions button{
  height:var(--control-height);
  padding:0 14px;
  border:1px solid var(--dialog-outline-strong);
  border-radius:var(--control-radius);
  background:var(--tb-surface);
  color:var(--dialog-text);
  cursor:pointer;
  transition:border-color .15s ease,color .15s ease,background .15s ease;
}
.file-actions button:hover:not(:disabled){
  border-color:var(--dialog-accent);
  color:var(--dialog-accent);
  background:var(--tb-surface-2);
}
.file-actions button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}
.wizard-step[data-step="3"] .file-actions{
  flex-wrap:wrap;
}
.wizard-step[data-step="3"] .file-table-wrapper{
  flex:1;
  min-height:0;
}
.file-table-wrapper{
  border:1px solid var(--tb-border);
  border-radius:8px;
  overflow:auto;
}
table{
  width:100%;
  border-collapse:collapse;
}
thead{
  background:var(--tb-surface-2);
  font-weight:600;
}
th,td{
  padding:10px;
  border-bottom:1px solid var(--tb-border);
  font-size:13px;
}
tbody tr.selected{
  background:rgba(0,130,201,0.12);
}
.empty-placeholder{
  padding:24px;
  text-align:center;
  font-size:13px;
  color:var(--tb-muted);
}
.status-progress{
  display:flex;
  align-items:center;
  gap:10px;
}
.status-progress .percent{
  width:38px;
  font-weight:600;
  text-align:right;
}
.status-progress .bar{
  flex:1;
  height:6px;
  background:var(--tb-surface-2);
  border-radius:4px;
  overflow:hidden;
}
.status-progress .bar span{
  display:block;
  height:100%;
  width:0;
  background:var(--brand-blue);
}
.status-text{
  font-size:12px;
  color:var(--tb-muted);
  margin-top:8px;
}
.nc-dialog-footer{
  border-top:1px solid var(--tb-border);
  padding:var(--dialog-gap) var(--dialog-pad-right) var(--dialog-gap) var(--dialog-pad-left);
  background:var(--tb-bg);
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-sizing:border-box;
}
.nc-dialog-footer button{
  padding:8px 18px;
  border-radius:6px;
  border:1px solid var(--tb-border);
  background:var(--tb-surface);
  cursor:pointer;
  font:inherit;
}
.nc-dialog-footer button.primary{
  background:var(--brand-blue);
  border-color:var(--brand-blue);
  color:#fff;
}
.nc-dialog-footer button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}
.footer-left,
.footer-right{
  display:flex;
  gap:12px;
}
@media (prefers-reduced-motion: reduce){
  .wizard-step.active{
    animation:none;
  }
}
</style>
<body>
  <div class="nc-dialog">
    <div class="nc-dialog-hero">
      <img src="assets/header-solid-blue-328x96.png" alt="NC Connector">
    </div>
    <div class="dialog-message" id="messageBar"></div>
    <div class="nc-dialog-content">
<section class="wizard-step active" data-step="1">
        <h2 data-i18n="sharing_heading_permissions">Freigabeeinstellungen</h2>
        <div class="form-row">
          <label for="shareName" data-i18n="sharing_share_name_label">Freigabename</label>
          <input id="shareName" type="text" data-i18n-placeholder="sharing_share_placeholder" placeholder="Freigabe">
        </div>
        <label class="checkbox-row">
          <input type="checkbox" id="permRead" checked disabled>
          <span data-i18n="sharing_permission_read">Lesen</span>
        </label>
        <label class="checkbox-row">
          <input type="checkbox" id="permCreate">
          <span data-i18n="sharing_permission_create">Erstellen</span>
        </label>
        <label class="checkbox-row">
          <input type="checkbox" id="permWrite">
          <span data-i18n="sharing_permission_write">Bearbeiten</span>
        </label>
        <label class="checkbox-row">
          <input type="checkbox" id="permDelete">
          <span data-i18n="sharing_permission_delete">Löschen</span>
        </label>
        <label class="checkbox-row">
          <input type="checkbox" id="passwordToggle">
          <span data-i18n="sharing_password_toggle">Freigabe-Passwort setzen</span>
        </label>
        <div class="inline-field" id="passwordFields">
          <input id="passwordInput" type="text" autocomplete="new-password" placeholder="********">
          <button type="button" id="passwordGenerate" data-i18n="sharing_password_generate">Generieren</button>
        </div>
      </section>

      <section class="wizard-step" data-step="2">
        <h2 data-i18n="sharing_step_expire">Ablaufdatum</h2>
        <label class="checkbox-row">
          <input type="checkbox" id="expireToggle" checked>
          <span data-i18n="sharing_expire_toggle">Ablaufdatum setzen</span>
        </label>
        <div class="inline-field" id="expireFields">
          <input type="date" id="expireDate">
        </div>
        <div class="status-text" data-i18n="sharing_expire_hint">Nach Ablauf ist der Link nicht mehr abrufbar.</div>
      </section>

      <section class="wizard-step" data-step="3">
        <h2 data-i18n="sharing_step_files_title">Dateien oder Ordner auswählen</h2>
        <div class="base-path">
          <span data-i18n="sharing_base_path_info">Basisverzeichnis:</span>
          <strong id="basePathLabel"></strong>
        </div>
        <div class="file-actions">
          <button type="button" id="addFilesBtn" data-i18n="sharing_button_add_files">Dateien hinzufügen...</button>
          <button type="button" id="addFolderBtn" data-i18n="sharing_button_add_folder">Ordner hinzufügen...</button>
          <button type="button" id="removeFileBtn" data-i18n="sharing_button_remove">Entfernen</button>
        </div>
        <div class="file-table-wrapper">
          <table>
            <thead>
              <tr>
                <th data-i18n="sharing_files_table_path">Pfad</th>
                <th data-i18n="sharing_files_table_type">Typ</th>
                <th data-i18n="sharing_files_table_status">Status</th>
              </tr>
            </thead>
            <tbody id="fileTableBody"></tbody>
          </table>
          <div class="empty-placeholder" id="fileEmptyPlaceholder" data-i18n="sharing_files_empty">Keine Dateien ausgewählt.</div>
        </div>
        <div class="status-text" id="uploadStatus"></div>
      </section>

      <section class="wizard-step" data-step="4">
        <h2 data-i18n="sharing_step_note_heading">Notiz an Empfänger</h2>
        <label class="checkbox-row">
          <input type="checkbox" id="noteToggle">
          <span data-i18n="sharing_note_toggle">Notiz für Empfänger hinzufügen</span>
        </label>
        <div class="form-row hidden" id="noteFields">
          <textarea id="noteInput" data-i18n-placeholder="sharing_note_placeholder" placeholder=""></textarea>
        </div>
      </section>
    </div>
    <div class="nc-dialog-footer">
      <div class="footer-left">
        <button type="button" id="backBtn" data-i18n="sharing_button_back">Zurück</button>
        <button type="button" id="uploadBtn" data-i18n="sharing_button_upload">Upload</button>
      </div>
      <div class="footer-right">
        <button type="button" id="nextBtn" data-i18n="sharing_button_next">Weiter</button>
        <button type="button" class="primary" id="finishBtn" data-i18n="sharing_button_finish">Fertigstellen</button>
        <button type="button" id="cancelBtn" data-i18n="sharing_button_cancel">Abbrechen</button>
      </div>
    </div>
  </div>
  <input type="file" id="fileInput" multiple hidden>
  <input type="file" id="folderInput" webkitdirectory hidden>
  <script src="../modules/i18n.js"></script>
  <script src="../modules/i18nOverride.js"></script>
  <script src="../modules/sharingStorage.js"></script>
  <script src="../modules/ocs.js"></script>
  <script src="textUtils.js"></script>
  <script src="../modules/nccore.js"></script>
  <script src="../modules/talkcore.js"></script>
  <script src="../modules/hostPermissions.js"></script>
  <script src="../modules/ncSharing.js"></script>
  <script src="popupSizing.js"></script>
  <script src="domI18n.js"></script>
  <script src="password.js"></script>
  <script src="nextcloudSharingWizard.js"></script>
</body>
















